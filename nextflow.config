conda.enabled = true
executor {
    name = 'local'
    cpus = 16          // Total CPU budget for local scheduling
    memory = '120 GB'  // Total RAM budget for local scheduling
}

process {
    // Allow processes to request up to the executor limits by default.
    // Override with e.g. `--max_cpus 8 --max_memory '60 GB'` if you want more concurrency.
    // Use closures so `params.*` is resolved at runtime (avoids `process.params.*` resolution errors).
    cpus = { params.max_cpus ?: 16 }
    memory = { params.max_memory ?: '120 GB' }

    // Keep lightweight steps lightweight to preserve some parallelism.
    withName:DOWNLOAD_PANEL { cpus = 1; memory = '2 GB' }
    withName:CREATE_REF_LISTS { cpus = 1; memory = '2 GB' }
    withName:INDEX_SAMPLE { cpus = 2; memory = '4 GB' }
    withName:PLOT_ANCESTRY { cpus = 2; memory = '8 GB' }
    withName:PLOT_PCA_ALL  { cpus = 2; memory = '8 GB' }
    withName:SUMMARIZE_Q   { cpus = 2; memory = '4 GB' }
    withName:SUMMARIZE_STRUCTURE_ALL { cpus = 2; memory = '4 GB' }
}
